<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Global - Crédito de Custeio</title>
    <!-- Favicon e CSS originais -->
    <link href="assets/images/svg/favicon.svg" rel="icon" />
    <link href="assets/css/swap.css" rel="stylesheet" />
    <link href="assets/css/slick.css" rel="stylesheet" />
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="assets/css/media_query.css" rel="stylesheet" />
    <link href="assets/css/custom-popup.css" rel="stylesheet" />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      /* =========================
         Regras para exibir/ocultar steps
         ========================= */
      .step {
        display: none;
      }
      .step.active {
        display: block;
      }

      /* Formatação do indicador de progresso */
      .progress-indicator {
        text-align: center;
        margin: 1.5rem 0;
        font-weight: bold;
        font-size: 1.1rem;
      }

      /* Espaçamento entre botões de navegação */
      .nav-buttons {
        margin-top: 2rem;
        display: flex;
        justify-content: space-between;
      }
      .obrigatorio-label::after {
        content: " (Obrigatório)";
        color: red;
        font-weight: normal;
        font-size: 0.85em;
      }
      /* =============================
     1) Caixa “Atividades Selecionadas”
     ============================= */
      .selecao-container {
        border: 1px solid #adb5bd; /* borda discreta */
        border-radius: 0.25rem; /* cantos levemente arredondados */
        background-color: #e9ecef; /* fundo cinza-claro */
        padding: 1rem; /* espaçamento interno */
        margin-bottom: 1.5rem; /* separação embaixo */
      }

      .selecao-container h6 {
        font-weight: 600;
        margin-bottom: 0.75rem;
      }

      /* Remover bullet-points padrão do <ul> */
      .selecao-container ul {
        list-style: none;
        padding-left: 0;
        margin-bottom: 0;
      }

      #selecaoAtividades .list-group-item {
        background: transparent;
        border: none;
        padding: 0.25rem 0;
      }

      #selecaoAtividades .list-group-item::before {
        content: "• ";
        color: #495057;
        font-weight: bold;
      }

      /* =============================
     2) Box de cada formulário dinâmico (com fundo suave para identificação)
     ============================= */
      .form-atividade {
        border: 1px solid #adb5bd; /* borda cinza */
        border-radius: 0.25rem; /* cantos arredondados */
        padding: 1rem 1.25rem; /* espaçamento interno */
        margin-bottom: 1.5rem; /* separação entre formulários */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        background-color: #ffffff; /* fundo branco */
      }

      /* Centralizando o título do formulário e destacando com uma borda inferior */
      .form-atividade h6 {
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        border-bottom: 2px solid #adb5bd;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        color: #343a40;
      }

      /* Cores suaves para o fundo de cada formulário, baseado na atividade */
      .form-atividade[data-atividade="Cultura Anual"] {
        background-color: #e3f2fd; /* Azul claro */
      }

      .form-atividade[data-atividade="Cultura Perene"] {
        background-color: #c8e6c9; /* Verde claro */
      }

      .form-atividade[data-atividade="Agricultura Geral"] {
        background-color: #ffccbc; /* Vermelho suave */
      }

      .form-atividade[data-atividade="Bovino de Corte"] {
        background-color: #fff9c4; /* Amarelo suave */
      }

      .form-atividade[data-atividade="Bovino de Leite"] {
        background-color: #b3e5fc; /* Azul claro */
      }

      .form-atividade[data-atividade="Pecuária Geral"] {
        background-color: #cfd8dc; /* Cinza suave */
      }

      /* Estilo básico para os botões */
      .btn-group button {
        margin-right: 5px;
        margin-top: 10px;
      }

      /* Caixa para exibir as culturas selecionadas */
      #selectedCulturesList {
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      /* Estilo para os formulários */
      .form-cultura {
        margin-top: 20px;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
      }
      .form-atividade h6 {
        text-align: center; /* Centraliza o título */
        font-size: 1.3rem; /* Aumenta o tamanho da fonte */
        font-weight: bold; /* Deixa a fonte em negrito */
        border-bottom: 3px solid #007bff; /* Borda inferior para destacar */
        padding-bottom: 5px;
        margin-bottom: 20px;
        color: #007bff; /* Cor do título */
        background-color: #f0f8ff; /* Fundo suave */
        padding-top: 10px;
        border-radius: 5px;
      }

      .form-atividade {
        border: 1px solid #adb5bd;
        border-radius: 0.25rem;
        padding: 1.25rem;
        margin-bottom: 30px; /* Aumenta o espaçamento entre os formulários */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background-color: #ffffff;
      }

      /* Estilo para o formulário da cultura */
      .form-cultura {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background-color: #f7f9fc;
        border-left: 5px solid #007bff;
      }

      /* Estilo dos títulos do formulário */
      .form-cultura h6 {
        font-size: 1.2rem;
        font-weight: bold;
        color: #0056b3;
        margin-bottom: 1rem;
      }

      /* Cada formulário de cultura com fundo e bordas coloridas diferentes */
      #form-Arroz {
        background-color: #e3f7fc; /* Azul claro */
        border-left: 5px solid #007bff;
      }

      #form-Milho {
        background-color: #f0f8e4; /* Verde claro */
        border-left: 5px solid #28a745;
      }

      #form-Soja {
        background-color: #fff7e6; /* Amarelo claro */
        border-left: 5px solid #ffc107;
      }

      #form-Sorgo {
        background-color: #fce4e1; /* Vermelho claro */
        border-left: 5px solid #dc3545;
      }

      #form-Trigo {
        background-color: #f8f9d7; /* Amarelo esverdeado */
        border-left: 5px solid #ffc107;
      }

      /* Estilo para os botões */
      .form-cultura .btn {
        margin-top: 1rem;
        font-weight: bold;
        color: white;
        background-color: #007bff;
        border-color: #007bff;
        transition: background-color 0.3s ease;
      }

      .form-cultura .btn:hover {
        background-color: #0056b3;
        border-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="site_content">
      <!-- ====================================== Preloader ===================================== -->
      <div class="page-loader" id="page-loader">
        <img alt="logo" src="assets/images/svg/logo.svg" />
        <p class="loade-text" data-text="Global">Global</p>
      </div>
      <!-- ====================================== Header ===================================== -->
      <header class="site_lr-spacer back-with-text" id="top-navbar">
        <a href="javascript:history.go(-1)">
          <img
            alt="back-btn-top"
            class="nav-header back-btn"
            src="assets/images/svg/back-btn-top.svg"
          />
        </a>
        <div class="header-title">
          <h1>Solicitação - Crédito de Custeio</h1>
        </div>
      </header>
      <!-- ====================================== Wizard “Coleta de Dados” ===================================== -->
      <section class="section-main section-main-ver site_lr-spacer">
        <!-- Indicador de progresso: Etapa X de 3 -->
        <div class="progress-indicator" id="progress-indicator">
          Etapa 1 de 6
        </div>
        <!-- Início do formulário wizard -->
        <form id="upgradeForm">
          <!-- =========================
     Etapa 1: PRODUTOR RURAL
     ========================= -->
          <div class="step active" id="step-1">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4">Etapa 1: Produtor Rural</h6>
                <div class="row g-3">
                  <div class="col-12 mb-4">
                    <label for="valor_credito" class="form-label fw-semibold"
                      >Valor do Crédito Desejado (R$)</label
                    >
                    <div class="d-flex align-items-center">
                      <input
                        type="range"
                        class="form-range me-3"
                        min="1000000"
                        max="100000000"
                        step="100000"
                        value="1000000"
                        id="valor_credito"
                        name="valor_credito"
                        oninput="atualizarValorCredito(this.value)"
                      />
                      <span id="valor_credito_exibido" class="fw-bold"
                        >R$ 1.000.000,00</span
                      >
                    </div>
                  </div>

                  <div class="col-12 mb-3">
                    <label class="form-label"> Produtor Rural </label>
                    <select
                      class="form-select"
                      id="produtor_tipo"
                      name="produtor_tipo"
                      required=""
                    >
                      <option selected="" value="">Selecione...</option>
                      <option value="PRONAF">PRONAF</option>
                      <option value="PRONAMP">PRONAMP</option>
                      <option value="Demais Produtores">
                        Demais Produtores
                      </option>
                    </select>
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label"> CPF/CNPJ </label>
                    <input
                      class="form-control"
                      id="cpf_cnpj"
                      name="cpf_cnpj"
                      placeholder="CPF ou CNPJ"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label"> Perfil do Produtor </label>
                    <input
                      class="form-control"
                      id="perfil_produtor"
                      name="perfil_produtor"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Experiência na atividade principal (anos)
                    </label>
                    <input
                      class="form-control"
                      id="experiencia"
                      min="0"
                      name="experiencia"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Assistência Técnica Agropecuária
                    </label>
                    <select
                      class="form-select"
                      id="assistencia_tecnica"
                      name="assistencia_tecnica"
                      required=""
                    >
                      <option selected="" value="">Selecione...</option>
                      <option>Sim: Órgão Estadual</option>
                      <option>Sim: Própria</option>
                      <option>Não possui</option>
                    </select>
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Desembolso anual manutenção familiar (R$)
                    </label>
                    <input
                      class="form-control"
                      id="desembolso_familiar"
                      name="desembolso_familiar"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Dívidas a vencer próximos 12 meses?
                    </label>
                    <input
                      class="form-control"
                      id="dividas_vencer"
                      name="dividas_vencer"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Dívidas direto com fornecedores (R$)
                    </label>
                    <input
                      class="form-control"
                      id="dividas_fornecedores"
                      name="dividas_fornecedores"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Custeio normal de outras instituições (R$)
                    </label>
                    <input
                      class="form-control"
                      id="custeio_outras"
                      name="custeio_outras"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Custeio prorrogado em outras instituições (R$)
                    </label>
                    <input
                      class="form-control"
                      id="custeio_prorrogado"
                      name="custeio_prorrogado"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Investimento em outras instituições (R$)
                    </label>
                    <input
                      class="form-control"
                      id="investimento_outras"
                      name="investimento_outras"
                      required=""
                      type="number"
                    />
                  </div>
                </div>
              </div>
            </div>
            <!-- Botões de navegação da Etapa 1 -->
            <div class="nav-buttons">
              <button class="btn btn-secondary" disabled="" type="button">
                Anterior
              </button>
              <button class="btn main-bg-color-btn" id="next-1" type="button">
                Próximo
              </button>
            </div>
          </div>
          <!-- =========================
     Etapa 2: PROPRIEDADE RURAL
     ========================= -->
          <div class="step" id="step-2">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4">Etapa 2: Propriedade Rural</h6>
                <p class="mb-3">
                  Dados da propriedade
                  <strong> PRINCIPAL </strong>
                </p>
                <div class="row g-3">
                  <div class="col-md-6 mb-3">
                    <label class="form-label"> Número do CCIR </label>
                    <input
                      class="form-control"
                      id="numero_ccir"
                      name="numero_ccir"
                      placeholder="Digite o CCIR"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label"> Nome da propriedade </label>
                    <input
                      class="form-control"
                      id="nome_propriedade"
                      name="nome_propriedade"
                      placeholder="Nome da propriedade"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">
                      Município da propriedade rural / UF
                    </label>
                    <input
                      class="form-control"
                      id="municipio_propriedade"
                      name="municipio_propriedade"
                      placeholder="Município / UF"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label"> Número de matrícula </label>
                    <input
                      class="form-control"
                      id="numero_matricula"
                      name="numero_matricula"
                      placeholder="Nº de matrícula"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Existe alienação ou gravame que incide sobre a matrícula?
                    </label>
                    <input
                      class="form-control"
                      id="alienacao_gravame"
                      name="alienacao_gravame"
                      placeholder="Sim/Não e detalhes"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">
                      Textura do solo predominante na área explorada
                    </label>
                    <input
                      class="form-control"
                      id="textura_solo"
                      name="textura_solo"
                      placeholder="Ex: Argiloso, Arenoso, etc."
                      required=""
                      type="text"
                    />
                  </div>
                </div>
              </div>
            </div>
            <!-- Botões de navegação da Etapa 2 -->
            <div class="nav-buttons">
              <button class="btn btn-secondary" id="prev-2" type="button">
                Anterior
              </button>
              <button class="btn main-bg-color-btn" id="next-2" type="button">
                Próximo
              </button>
            </div>
          </div>
          <!-- =========================
     Etapa 3: ATIVIDADE RURAL NAS PROPRIEDADES
     ========================= -->
          <div class="step" id="step-3">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4 obrigatorio-label">
                  Etapa 3: Atividade Rural nas Propriedades
                </h6>
                <p class="mb-3">
                  Qual atividade rural é desempenhada nas propriedades
                </p>

                <!-- Atividades (checkboxes) -->
                <div class="row g-3">
                  <!-- Cultura Anual -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade1"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Cultura Anual"
                    />
                    <label class="btn btn-primary w-100" for="atividade1">
                      Cultura Anual
                    </label>
                  </div>

                  <!-- Cultura Perene -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade2"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Cultura Perene"
                    />
                    <label class="btn btn-success w-100" for="atividade2">
                      Cultura Perene
                    </label>
                  </div>

                  <!-- Agricultura Geral -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade3"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Agricultura Geral"
                    />
                    <label class="btn btn-danger w-100" for="atividade3">
                      Agricultura Geral
                    </label>
                  </div>

                  <!-- Bovino de Corte -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade4"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Bovino de Corte"
                    />
                    <label class="btn btn-warning w-100" for="atividade4">
                      Bovino de Corte
                    </label>
                  </div>

                  <!-- Bovino de Leite -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade5"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Bovino de Leite"
                    />
                    <label class="btn btn-info w-100" for="atividade5">
                      Bovino de Leite
                    </label>
                  </div>

                  <!-- Pecuária Geral -->
                  <div class="col-4">
                    <input
                      autocomplete="off"
                      class="btn-check"
                      id="atividade6"
                      name="atividade_props[]"
                      onclick="updateSelections()"
                      type="checkbox"
                      value="Pecuária Geral"
                    />
                    <label class="btn btn-dark w-100" for="atividade6">
                      Pecuária Geral
                    </label>
                  </div>
                </div>

                <!-- Seção de seleções -->
                <div class="mt-3">
                  <h6 class="fw-semibold">Atividades Selecionadas:</h6>
                  <!-- A lista de atividades selecionadas vai aparecer aqui -->
                  <div class="selecao-container">
                    <ul class="list-group" id="selecaoAtividades">
                      <!-- As seleções do usuário aparecem aqui -->
                    </ul>
                  </div>
                </div>

                <!-- Container para os formulários dinâmicos (Cultura Anual, etc.) -->
                <div id="formulariosAtividadesContainer" class="mt-4">
                  <!-- Formulários serão injetados aqui -->
                </div>
              </div>
            </div>

            <!-- Botões de navegação da Etapa 3 -->
            <div class="nav-buttons">
              <button class="btn btn-secondary" id="prev-3" type="button">
                Anterior
              </button>
              <button class="btn main-bg-color-btn" id="next-3" type="button">
                Próximo
              </button>
            </div>
          </div>

          <!-- =========================
     Etapa 4: Proprietário do Imóvel
     ========================= -->
          <!-- =========================
   Etapa 4: Proprietário do Imóvel
   ========================= -->
          <div class="step" id="step-4">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4">
                  Etapa 4: Proprietário do Imóvel/Matrícula
                </h6>
                <p class="mb-3">
                  Caso o produtor rural NÃO seja proprietário do
                  imóvel/matrícula, preencher os campos abaixo.
                </p>
                <div class="row g-3">
                  <div class="col-12">
                    <label class="form-label">
                      Nome ou Razão Social do Proprietário
                    </label>
                    <input
                      class="form-control"
                      id="nome_proprietario"
                      name="nome_proprietario"
                      placeholder="Nome ou Razão Social"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label"> CPF/CNPJ </label>
                    <input
                      class="form-control"
                      id="cpf_cnpj_proprietario"
                      name="cpf_cnpj_proprietario"
                      placeholder="CPF ou CNPJ"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label">
                      Porcentagem de Propriedade (%)
                    </label>
                    <input
                      class="form-control"
                      id="percentual_propriedade"
                      max="100"
                      min="0"
                      name="percentual_propriedade"
                      placeholder="%"
                      required=""
                      type="number"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label">
                      A propriedade possui contrato de
                      arrendamento/comodato/parceria/usufruto? Ou condição de
                      posseiro?
                    </label>
                    <input
                      class="form-control"
                      id="condicao_posseiro"
                      name="condicao_posseiro"
                      placeholder="Descreva a condição"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label"> Perfil </label>
                    <input
                      class="form-control"
                      id="perfil"
                      name="perfil"
                      placeholder="Perfil"
                      required=""
                      type="text"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label">
                      Tamanho da área no contrato (ha)
                    </label>
                    <input
                      class="form-control"
                      id="tamanho_area_contrato"
                      name="tamanho_area_contrato"
                      placeholder="Tamanho da área"
                      required=""
                      step="0.01"
                      type="number"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label"> Vencimento do contrato </label>
                    <input
                      class="form-control"
                      id="vencimento_contrato"
                      name="vencimento_contrato"
                      required=""
                      type="date"
                    />
                  </div>
                  <div class="col-12">
                    <label class="form-label"> Valor do contrato (R$) </label>
                    <input
                      class="form-control"
                      id="valor_contrato"
                      name="valor_contrato"
                      placeholder="Valor do contrato"
                      required=""
                      step="0.01"
                      type="number"
                    />
                  </div>
                </div>
                <div class="mt-4" id="formulariosAtividades">
                  <div
                    class="form-atividade d-none"
                    data-atividade="Cultura Anual"
                  >
                    <h6>Cultura Anual</h6>
                    <input
                      type="text"
                      class="form-control mb-2"
                      placeholder="Tipo de cultura anual"
                    />
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Área (ha)"
                    />
                  </div>
                  <div
                    class="form-atividade d-none"
                    data-atividade="Cultura Perene"
                  >
                    <h6>Cultura Perene</h6>
                    <input
                      type="text"
                      class="form-control mb-2"
                      placeholder="Tipo de cultura perene"
                    />
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Área (ha)"
                    />
                  </div>
                  <div
                    class="form-atividade d-none"
                    data-atividade="Agricultura Geral"
                  >
                    <h6>Agricultura Geral</h6>
                    <input
                      type="text"
                      class="form-control mb-2"
                      placeholder="Descrição da produção agrícola"
                    />
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Produção estimada (ton)"
                    />
                  </div>
                  <div
                    class="form-atividade d-none"
                    data-atividade="Bovino de Corte"
                  >
                    <h6>Bovino de Corte</h6>
                    <input
                      type="number"
                      class="form-control mb-2"
                      placeholder="Quantidade de cabeças"
                    />
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Sistema de criação"
                    />
                  </div>
                  <div
                    class="form-atividade d-none"
                    data-atividade="Bovino de Leite"
                  >
                    <h6>Bovino de Leite</h6>
                    <input
                      type="number"
                      class="form-control mb-2"
                      placeholder="Quantidade de vacas leiteiras"
                    />
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Produção diária (litros)"
                    />
                  </div>
                  <div
                    class="form-atividade d-none"
                    data-atividade="Pecuária Geral"
                  >
                    <h6>Pecuária Geral</h6>
                    <input
                      type="text"
                      class="form-control mb-2"
                      placeholder="Tipo de pecuária"
                    />
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Quantidade total de animais"
                    />
                  </div>
                </div>
              </div>
            </div>
            <!-- Botões de navegação da Etapa 4 -->
            <div class="nav-buttons">
              <button class="btn btn-secondary" id="prev-4" type="button">
                Anterior
              </button>
              <button class="btn main-bg-color-btn" id="next-4" type="button">
                Próximo
              </button>
            </div>
          </div>
          <div class="step" id="step-5">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4">
                  Etapa 5: Propriedades Secundárias
                </h6>
                <p class="mb-3 obrigatorio-label">
                  Selecione quantas propriedades secundárias deseja cadastrar:
                </p>
                <select
                  class="form-select mb-4"
                  id="num_secundarias"
                  onchange="renderSecundarias(this.value)"
                >
                  <option value="">Selecione...</option>
                  <option value="0">0 propriedade</option>
                  <option value="1">1 propriedade</option>
                  <option value="2">2 propriedades</option>
                  <option value="3">3 propriedades</option>
                  <option value="4">4 propriedades</option>
                  <option value="5">5 propriedades</option>
                  <option value="6">6 propriedade</option>
                  <option value="7">7 propriedades</option>
                  <option value="8">8 propriedades</option>
                  <option value="9">9 propriedades</option>
                  <option value="10">10 propriedades</option>
                </select>
                <div id="secundariasContainer"></div>
              </div>
            </div>
            <div class="nav-buttons">
              <button class="btn btn-secondary" id="prev-5" type="button">
                Anterior
              </button>
              <button class="btn main-bg-color-btn" id="next-5" type="button">
                Próximo
              </button>
            </div>
          </div>
          <!-- =========================
     Etapa 6: Autorização
     ========================= -->
          <div class="step" id="step-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h6 class="fw-semibold mb-4">
                  Etapa 6: Autorização e Declarações
                </h6>

                <div class="mb-3">
                  <p class="form-text small">
                    Autorizo, nos termos da Resolução CMN nº 3.658 de
                    17.12.2008, a <strong>GLOBAL</strong> a consultar as
                    informações consolidadas, relativas à minha pessoa ou à
                    empresa e seus sócios, se for o caso, constantes no Sistema
                    de Informações de Créditos (SCR) do BACEN.
                  </p>
                  <p class="form-text small">
                    Autorizo, ainda, a GLOBAL a fornecer informações sobre as
                    operações de crédito com ela realizadas, no sentido de
                    compor o cadastro do citado sistema. Os presentes dados são
                    verdadeiros e visam facilitar os processos de negociação e
                    transações comerciais, pela antecipação de informações a meu
                    respeito.
                  </p>
                  <p class="form-text small">
                    Autorizo o arquivamento dos meus dados pessoais e de
                    idoneidade na <strong>SERASA</strong> - Centralização de
                    Serviços dos Bancos S/A, que poderá deles se utilizar,
                    respeitadas as disposições legais em vigor. Para os devidos
                    fins de direito, declaro(amos) responsável(eis) pela
                    veracidade das informações prestadas neste formulário e
                    autorizamos sua confirmação.
                  </p>
                  <p class="form-text small">
                    Declaro que:<br />
                    • as informações por mim prestadas sobre renda/faturamento e
                    patrimônio são lícitas;<br />
                    • tenho ciência da Lei nº 9.613/98, que dispõe sobre os
                    crimes de “lavagem” ou ocultação de bens, direitos e
                    valores, com as alterações introduzidas, e dos arts. 297,
                    298 e 299 do Código Penal;<br />
                    • estou ciente de que a falsidade dos dados declarados
                    configura crime previsto na legislação brasileira, passível
                    de responsabilização civil, criminal e administrativa,
                    podendo implicar na imediata revogação das avaliações de
                    risco de crédito, das operações avaliadas e não contratadas
                    e do vencimento antecipado das operações de crédito vigentes
                    vinculadas a tais dados.
                  </p>
                </div>

                <div class="form-check mt-4">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="aceite_final"
                    required
                  />
                  <label class="form-check-label" for="aceite_final">
                    Declaro que li e aceito os termos acima.
                  </label>
                </div>
              </div>
            </div>

            <div class="nav-buttons mt-3">
              <button class="btn btn-secondary" type="button" id="prev-6">
                Anterior
              </button>
              <button
                class="btn btn-success"
                id="enviarFormulario"
                type="button"
              >
                Enviar Formulário
              </button>
            </div>
          </div>
        </form>
      </section>
    </div>
    <div
      class="modal fade"
      id="avisoModal"
      tabindex="-1"
      aria-labelledby="avisoLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="font-family: Arial, sans-serif">
          <div class="modal-header" style="background-color: #f0f8ff">
            <h5 class="modal-title" id="avisoLabel" style="color: #007bff">
              📢 Aviso Importante
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Fechar"
            ></button>
          </div>
          <div class="modal-body" style="background-color: #f0f8ff">
            <p>
              Preencha o máximo de informações que você tiver em mãos no
              momento.
            </p>
            <p>
              Caso não tenha acesso a todos os dados agora, não se preocupe —
              será possível
              <strong
                >editar, complementar e atualizar sua solicitação
                posteriormente</strong
              >.
            </p>
            <p>
              Além disso, nossa equipe entrará em contato com você para
              <strong>ajudar no preenchimento completo</strong> e esclarecer
              <strong>qualquer dúvida</strong> que você tiver durante o
              processo.
            </p>
          </div>
          <div class="modal-footer" style="background-color: #f0f8ff">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              Entendi
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ====================================== Scripts ===================================== -->
    <script src="assets/javascript/jquery.js"></script>
    <script src="assets/javascript/slick.min.js"></script>
    <script src="assets/javascript/bootstrap.min.js"></script>
    <script src="assets/javascript/script.js"></script>
    <script src="assets/javascript/custom-popup.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Script de autenticação -->
    <script src="assets/js/auth.js"></script>

    <script>
      // ===================================================================
      // 1. SISTEMA DE GERENCIAMENTO DE ESTADO GLOBAL
      // ===================================================================

      const FormStateManager = {
        // Armazena dados de todas as atividades
        atividadesData: {},

        // Armazena dados de todas as culturas (dentro de Cultura Anual)
        culturasData: {},

        // Salva dados de um formulário específico
        saveFormData: function (formId, data) {
          if (formId.startsWith("cultura-")) {
            this.culturasData[formId] = data;
          } else {
            this.atividadesData[formId] = data;
          }
          // Auto-save no localStorage
          this.saveToLocalStorage();
        },

        // Recupera dados de um formulário específico
        getFormData: function (formId) {
          if (formId.startsWith("cultura-")) {
            return this.culturasData[formId] || {};
          } else {
            return this.atividadesData[formId] || {};
          }
        },

        // Coleta dados de todos os campos de um formulário
        collectFormData: function (formElement) {
          const data = {};
          const inputs = formElement.querySelectorAll(
            "input, select, textarea"
          );

          inputs.forEach((input) => {
            if (input.type === "checkbox" || input.type === "radio") {
              data[input.name] = input.checked;
            } else {
              data[input.name] = input.value;
            }
          });

          return data;
        },

        // Restaura dados em um formulário
        restoreFormData: function (formElement, data) {
          Object.keys(data).forEach((fieldName) => {
            const field = formElement.querySelector(`[name="${fieldName}"]`);
            if (field) {
              if (field.type === "checkbox" || field.type === "radio") {
                field.checked = data[fieldName];
              } else {
                field.value = data[fieldName];
              }
            }
          });
        },

        // Persistência em LocalStorage
        saveToLocalStorage: function () {
          try {
            localStorage.setItem(
              "formData_atividades",
              JSON.stringify(this.atividadesData)
            );
            localStorage.setItem(
              "formData_culturas",
              JSON.stringify(this.culturasData)
            );
          } catch (e) {
            console.warn("Erro ao salvar no localStorage:", e);
          }
        },

        loadFromLocalStorage: function () {
          try {
            const atividadesData = localStorage.getItem("formData_atividades");
            const culturasData = localStorage.getItem("formData_culturas");

            if (atividadesData) {
              this.atividadesData = JSON.parse(atividadesData);
            }

            if (culturasData) {
              this.culturasData = JSON.parse(culturasData);
            }
          } catch (e) {
            console.warn("Erro ao carregar do localStorage:", e);
          }
        },

        clearLocalStorage: function () {
          localStorage.removeItem("formData_atividades");
          localStorage.removeItem("formData_culturas");
          this.atividadesData = {};
          this.culturasData = {};
        },
      };

      // ===================================================================
      // 2. CONTROLE DE NAVEGAÇÃO ENTRE STEPS (MANTIDO ORIGINAL)
      // ===================================================================

      document.addEventListener("DOMContentLoaded", function () {
        // Carregar dados salvos
        FormStateManager.loadFromLocalStorage();

        const steps = document.querySelectorAll(".step");
        const progressIndicator = document.getElementById("progress-indicator");

        let currentStep = 0; // index de steps (0 => step-1, 1 => step-2, 2 => step-3, 3 => step-4)

        // Função para exibir somente o step “index” e atualizar indicador
        function showStep(index) {
          steps.forEach((stepDiv, i) => {
            if (i === index) {
              stepDiv.classList.add("active");
            } else {
              stepDiv.classList.remove("active");
            }
          });
          progressIndicator.textContent = `Etapa ${index + 1} de ${
            steps.length
          }`;
          currentStep = index;
        }

        // Botão “Próximo” da Etapa 1
        document.getElementById("next-1").addEventListener("click", () => {
          // Aqui você pode validar campos de step 1 antes de avançar, se desejar
          showStep(1);
        });

        // Botão “Próximo” da Etapa 2
        document.getElementById("next-2").addEventListener("click", () => {
          // Aqui você pode validar campos de step 2 antes de avançar, se desejar
          showStep(2);
        });

        // Botão “Próximo” da Etapa 3
        document.getElementById("next-3").addEventListener("click", () => {
          const selecionadas = document.querySelectorAll(
            'input[name="atividade_props[]"]:checked'
          );
          if (selecionadas.length === 0) {
            alert("Por favor, selecione pelo menos uma atividade rural.");
            return;
          }
          showStep(3); // Avançar para Etapa 4
        });

        // Botão “Anterior” da Etapa 2
        document.getElementById("prev-2").addEventListener("click", () => {
          showStep(0);
        });

        // Botão “Anterior” da Etapa 3
        document.getElementById("prev-3").addEventListener("click", () => {
          showStep(1);
        });

        // Botão “Anterior” da Etapa 4
        document.getElementById("prev-4").addEventListener("click", () => {
          showStep(2);
        });
        // Botão “Próximo” da Etapa 4
        document.getElementById("next-4").addEventListener("click", () => {
          showStep(4); // Avançar para a Etapa 5
        });
        // Botão “Anterior” da Etapa 5
        document.getElementById("prev-5").addEventListener("click", () => {
          showStep(3); // Voltar para a Etapa 4
        });
        document.getElementById("next-5").addEventListener("click", () => {
          const quantidade = parseInt(
            document.getElementById("num_secundarias").value
          );

          if (isNaN(quantidade)) {
            alert(
              "Por favor, selecione a quantidade de propriedades secundárias."
            );
            return;
          }

          if (quantidade === 0) {
            showStep(5); // Avança direto se não tiver propriedades secundárias
            return;
          }

          let valid = true;
          for (let i = 1; i <= quantidade; i++) {
            const select = document.querySelector(
              `[name="secundaria_proprietario_${i}"]`
            );
            if (!select || select.value === "") {
              valid = false;
            }
          }

          if (!valid) {
            alert(
              'Preencha o campo "Você é o proprietário?" para todas as propriedades secundárias.'
            );
            return;
          }

          showStep(5); // Avançar para Etapa 6
        });

        document
          .getElementById("prev-6")
          .addEventListener("click", () => showStep(4));
        // Botão “Finalizar” da Etapa 4
        document.getElementById("finish").addEventListener("click", () => {
          // Se quiser submeter o formulário, use:
          // document.getElementById("upgradeForm").submit();
          //
          // No exemplo anterior, havia um link “Continue” para paymentMethod.html.
          // Caso queira apenas redirecionar para a próxima página, use:
          window.location.href = "paymentMethod.html"; // Redireciona para outra página (se necessário)
        });
      });
    </script>

    <script>
      // ===================================================================
      // 3. FUNÇÃO updateSelections() CORRIGIDA
      // ===================================================================

      function updateSelections() {
        const checkboxes = document.querySelectorAll(
          'input[name="atividade_props[]"]:checked'
        );
        const selecaoAtividades = document.getElementById("selecaoAtividades");
        const formulariosAtividadesContainer = document.getElementById(
          "formulariosAtividadesContainer"
        );

        // SOLUÇÃO: Salvar dados antes de qualquer modificação
        saveAllFormsData();

        // Obter atividades atualmente selecionadas
        const atividadesSelecionadas = Array.from(checkboxes).map(
          (cb) => cb.value
        );

        // Obter atividades já renderizadas
        const atividadesRenderizadas = Array.from(
          formulariosAtividadesContainer.querySelectorAll(".form-atividade")
        ).map((form) => form.getAttribute("data-atividade"));

        // Remover formulários de atividades desmarcadas
        atividadesRenderizadas.forEach((atividade) => {
          if (!atividadesSelecionadas.includes(atividade)) {
            const formToRemove = formulariosAtividadesContainer.querySelector(
              `[data-atividade="${atividade}"]`
            );
            if (formToRemove) {
              formToRemove.remove();
            }
          }
        });

        // Adicionar formulários para novas atividades selecionadas
        atividadesSelecionadas.forEach((atividade) => {
          if (!atividadesRenderizadas.includes(atividade)) {
            // Criar novo formulário
            const form = document.createElement("div");
            form.classList.add("form-atividade");
            form.setAttribute("data-atividade", atividade);
            form.innerHTML = getFormHtml(atividade);
            formulariosAtividadesContainer.appendChild(form);

            // Restaurar dados salvos
            const savedData = FormStateManager.getFormData(atividade);
            if (Object.keys(savedData).length > 0) {
              FormStateManager.restoreFormData(form, savedData);
            }

            // Adicionar auto-save
            addAutoSaveListeners(form, atividade);

            // Se for Cultura Anual, restaurar estado das culturas
            if (atividade === "Cultura Anual") {
              restoreCultureState();
            }
          }
        });

        // Atualizar lista de atividades selecionadas
        updateAtividadesList(atividadesSelecionadas);
      }

      // ===================================================================
      // 4. FUNÇÕES AUXILIARES PARA PRESERVAÇÃO DE ESTADO
      // ===================================================================

      function saveAllFormsData() {
        // Salvar dados das atividades
        const formsAtividades = document.querySelectorAll(".form-atividade");
        formsAtividades.forEach((form) => {
          const atividade = form.getAttribute("data-atividade");
          const data = FormStateManager.collectFormData(form);
          FormStateManager.saveFormData(atividade, data);
        });

        // Salvar dados das culturas
        const formsCulturas = document.querySelectorAll(".form-cultura");
        formsCulturas.forEach((form) => {
          const culturaId = form.id.replace("form-", "cultura-");
          const data = FormStateManager.collectFormData(form);
          FormStateManager.saveFormData(culturaId, data);
        });
      }

      function updateAtividadesList(atividades) {
        const selecaoAtividades = document.getElementById("selecaoAtividades");
        selecaoAtividades.innerHTML = "";

        atividades.forEach((atividade) => {
          const listItem = document.createElement("li");
          listItem.classList.add("list-group-item");
          listItem.textContent = atividade;
          selecaoAtividades.appendChild(listItem);
        });
      }

      function addAutoSaveListeners(formElement, formId) {
        const inputs = formElement.querySelectorAll("input, select, textarea");

        inputs.forEach((input) => {
          // Salvar dados a cada mudança
          input.addEventListener("change", function () {
            const data = FormStateManager.collectFormData(formElement);
            FormStateManager.saveFormData(formId, data);
          });

          // Para inputs de texto, salvar também ao digitar (com debounce)
          if (
            input.type === "text" ||
            input.type === "number" ||
            input.tagName === "TEXTAREA"
          ) {
            let timeout;
            input.addEventListener("input", function () {
              clearTimeout(timeout);
              timeout = setTimeout(() => {
                const data = FormStateManager.collectFormData(formElement);
                FormStateManager.saveFormData(formId, data);
              }, 500);
            });
          }
        });
      }

      // ===================================================================
      // 5. SISTEMA DE CULTURAS MELHORADO
      // ===================================================================

      let selectedCultures = [];

      function toggleCultureSelection(culture) {
        // Salvar dados antes de modificar
        saveAllCulturesData();

        const index = selectedCultures.indexOf(culture);

        if (index > -1) {
          // Remover cultura
          selectedCultures.splice(index, 1);
          removeCultureForm(culture);
        } else {
          // Adicionar cultura
          selectedCultures.push(culture);
          addCultureForm(culture);
        }

        updateSelectedCulturesList();
        updateCultureButtons();

        // Salvar estado das culturas selecionadas
        FormStateManager.saveFormData("selectedCultures", selectedCultures);
      }

      function addCultureForm(culture) {
        const container = document.getElementById("culturasFormsContainer");

        // Verificar se formulário já existe
        if (document.getElementById(`form-${culture}`)) {
          return;
        }

        const formDiv = document.createElement("div");
        formDiv.className = "form-cultura";
        formDiv.id = `form-${culture}`;
        formDiv.innerHTML = getCultureFormHtml(culture);

        container.appendChild(formDiv);

        // Restaurar dados salvos
        const savedData = FormStateManager.getFormData(`cultura-${culture}`);
        if (Object.keys(savedData).length > 0) {
          FormStateManager.restoreFormData(formDiv, savedData);
        }

        // Adicionar auto-save
        addAutoSaveListeners(formDiv, `cultura-${culture}`);
      }

      function removeCultureForm(culture) {
        const form = document.getElementById(`form-${culture}`);
        if (form) {
          // Salvar dados antes de remover
          const data = FormStateManager.collectFormData(form);
          FormStateManager.saveFormData(`cultura-${culture}`, data);
          form.remove();
        }
      }

      function saveAllCulturesData() {
        const formsCulturas = document.querySelectorAll(".form-cultura");
        formsCulturas.forEach((form) => {
          const culturaId = form.id.replace("form-", "cultura-");
          const data = FormStateManager.collectFormData(form);
          FormStateManager.saveFormData(culturaId, data);
        });
      }

      function updateSelectedCulturesList() {
        const list = document.getElementById("selectedCulturesList");
        if (!list) return;

        list.innerHTML = "";

        selectedCultures.forEach((culture) => {
          const listItem = document.createElement("li");
          listItem.className = "list-group-item";
          listItem.textContent = culture;
          list.appendChild(listItem);
        });
      }

      function updateCultureButtons() {
        const buttons = document.querySelectorAll(
          '[onclick^="toggleCultureSelection"]'
        );
        buttons.forEach((button) => {
          const culture = button.textContent.trim();
          if (selectedCultures.includes(culture)) {
            button.classList.remove("btn-info");
            button.classList.add("btn-success");
          } else {
            button.classList.remove("btn-success");
            button.classList.add("btn-info");
          }
        });
      }

      function restoreCultureState() {
        // Restaurar culturas selecionadas
        const savedCultures = FormStateManager.getFormData("selectedCultures");
        if (Array.isArray(savedCultures)) {
          selectedCultures = savedCultures;

          // Recriar formulários das culturas
          selectedCultures.forEach((culture) => {
            addCultureForm(culture);
          });

          updateSelectedCulturesList();
          updateCultureButtons();
        }
      }

      // ===================================================================
      // 6. FUNÇÃO getFormHtml() MANTIDA ORIGINAL
      // ===================================================================

      function getFormHtml(atividade) {
        let formHtml = "";

        switch (atividade) {
          case "Cultura Anual":
            formHtml = `
    <!-- Título do formulário centralizado -->
    <h6 class="text-center">Cultura Anual</h6>

    <!-- Selecione as culturas anuais diretamente -->
    <div class="mt-3 text-center">
      <h6 class="text-center">Selecione uma ou mais cultura anual:</h6>
      <div class="d-flex justify-content-center">
        <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Algodão\')"
          >
            Algodão
          </button>
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Arroz\')"
          >
            Arroz
          </button>
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Milho\')"
          >
            Milho
          </button>
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Soja\')"
          >
            Soja
          </button>
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Sorgo\')"
          >
            Sorgo
          </button>
          <button
            type="button"
            class="btn btn-info"
            onclick="toggleCultureSelection(\'Trigo\')"
          >
            Trigo
          </button>
        </div>
      </div>
    </div>

    <!-- Caixa para exibir as culturas selecionadas -->
    <div class="mt-3 text-center">
      <h6 class="text-center">Culturas Selecionadas:</h6>
      <ul class="list-group d-inline-block text-start" id="selectedCulturesList" style="min-width: 200px;">
        <!-- As seleções do usuário aparecerão aqui -->
      </ul>
    </div>

    <!-- Container para os formulários dinâmicos das culturas selecionadas -->
    <div id="culturasFormsContainer" class="mt-4">
      <!-- Formulários para cada cultura selecionada aparecerão aqui -->
    </div>
`;

            break;

          case "Cultura Perene":
            formHtml = `
            <h6>Cultura Perene</h6>
            <input type="text" class="form-control mb-2" name="cultura_perene_tipo" placeholder="Tipo de cultura perene" />
            <input type="number" class="form-control" name="cultura_perene_area" placeholder="Área (ha)" />
          `;
            break;
          case "Agricultura Geral":
            formHtml = `
            <h6>Agricultura Geral</h6>
            <input type="text" class="form-control mb-2" name="agricultura_geral_descricao" placeholder="Descrição da produção agrícola" />
            <input type="number" class="form-control" name="agricultura_geral_producao" placeholder="Produção estimada (ton)" />
          `;
            break;
          case "Bovino de Corte":
            formHtml = `
            <h6>Bovino de Corte</h6>
            <input type="number" class="form-control mb-2" name="bovino_corte_cabecas" placeholder="Quantidade de cabeças" />
            <input type="text" class="form-control" name="bovino_corte_sistema" placeholder="Sistema de criação" />
          `;
            break;
          case "Bovino de Leite":
            formHtml = `
            <h6>Bovino de Leite</h6>
            <input type="number" class="form-control mb-2" name="bovino_leite_vacas" placeholder="Quantidade de vacas leiteiras" />
            <input type="number" class="form-control" name="bovino_leite_producao" placeholder="Produção diária (litros)" />
          `;
            break;
          case "Pecuária Geral":
            formHtml = `
            <h6>Pecuária Geral</h6>
            <input type="text" class="form-control mb-2" name="pecuaria_geral_tipo" placeholder="Tipo de pecuária" />
            <input type="number" class="form-control" name="pecuaria_geral_animais" placeholder="Quantidade total de animais" />
          `;
            break;
          default:
            formHtml = `<p>Formulário não disponível para a atividade selecionada.</p>`;
        }

        return formHtml;
      }
    </script>

    <script>
      // ===================================================================
      // 7. FUNÇÃO getCultureFormHtml() MANTIDA ORIGINAL
      // ===================================================================

      function getCultureFormHtml(culture) {
        return `
          <div class="border p-3 mb-3">
              <h6 class="fw-bold text-center mb-3">${culture}</h6>
              
              <h6 class="mt-3">Histórico de safras anteriores</h6>
              <div class="col-12 mb-3">
                  <label class="form-label">03 anos atrás (ha)</label>
                  <input type="number" class="form-control mb-2" name="${culture}_hist_3anos_ha" placeholder="03 anos atrás (ha)" min="0" step="0.01" required />
              </div>
              <div class="col-12 mb-3">
                  <label class="form-label">02 anos atrás (ha)</label>
                  <input type="number" class="form-control mb-2" name="${culture}_hist_2anos_ha" placeholder="02 anos atrás (ha)" min="0" step="0.01" required />
              </div>
              <div class="col-12 mb-3">
                  <label class="form-label">01 ano atrás (ha)</label>
                  <input type="number" class="form-control mb-2" name="${culture}_hist_1ano_ha" placeholder="01 ano atrás (ha)" min="0" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Município</label>
                  <input type="text" class="form-control mb-2" name="${culture}_cultura_anual_municipio" placeholder="Município" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Matrícula</label>
                  <input type="text" class="form-control mb-2" name="${culture}_cultura_anual_matricula" placeholder="Matrícula" required />
              </div>

              <h6 class="mt-3">Dados da safra prevista</h6>
              <div class="col-12 mb-3">
                  <label class="form-label">Área de plantio da cultura na safra prevista (ha)</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_area_plantio" placeholder="Área de plantio da cultura na safra prevista (ha)" min="0" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Percentual da área total da cultura com irrigação</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_pct_irrigacao" placeholder="Percentual da área total da cultura com irrigação" min="0" max="100" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Percentual da área total da cultura com mecanização de colheita</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_pct_mecanizacao" placeholder="Percentual da área total da cultura com mecanização de colheita" min="0" max="100" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Percentual da produção utilizada para consumo próprio</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_pct_consumo_proprio" placeholder="Percentual da produção utilizada para consumo próprio" min="0" max="100" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Percentual da produção com armazenamento próprio</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_pct_armazenamento" placeholder="Percentual da produção com armazenamento próprio" min="0" max="100" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Produtividade média estimada para a safra (Kg/ha)</label>
                  <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_produtividade_kg_ha" placeholder="Produtividade média estimada para a safra (Kg/ha)" min="0" step="0.01" required />
              </div>

              <div class="col-12 mb-3">
                  <label class="form-label">Nível tecnológico adotado para esta cultura</label>
                  <select class="form-control mb-2" name="${culture}_cultura_anual_nivel_tecnologico" required>
                      <option value="">Selecione o nível tecnológico</option>
                      <option value="Alto">Alto</option>
                      <option value="Médio">Médio</option>
                      <option value="Baixo">Baixo</option>
                  </select>
              </div>

              <h6 class="mt-3">Dados financeiros da safra prevista</h6>
              <div class="row">
                  <div class="col-6">
                      <label class="d-block">Receita estimada</label>
                      <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_preco_venda_rkg" placeholder="Preço estimado de venda (R$/kg)" min="0" step="0.01" required />
                  </div>
                  <div class="col-6">
                      <label class="d-block">Despesa estimada</label>
                      <input type="number" class="form-control mb-2" name="${culture}_cultura_anual_custo_producao_rha" placeholder="Custo estimado de produção (R$/ha)" min="0" step="0.01" required />
                  </div>
              </div>

              <div class="form-inline mb-2">
                  <input type="number" class="form-control mr-2" name="${culture}_cultura_anual_ano_safra_inicio" placeholder="Ano-safra início" min="1900" max="2100" required />
                  <span class="mx-1">/</span>
                  <input type="number" class="form-control" name="${culture}_cultura_anual_ano_safra_fim" placeholder="Ano-safra fim" min="1900" max="2100" required />
              </div>
          </div>
      `;
      }
    </script>

    <script>
      function renderSecundarias(qtd) {
        const container = document.getElementById("secundariasContainer");
        container.innerHTML = "";
        for (let i = 1; i <= qtd; i++) {
          container.innerHTML += `
        <div class="border p-3 mb-4">
          <h6 class="fw-bold mb-3">Propriedade Secundária ${i}</h6>
          <div class="mb-3">
            <label class="form-label">Nome da Propriedade</label>
            <input type="text" class="form-control" name="secundaria_nome_${i}" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Município / UF</label>
            <input type="text" class="form-control" name="secundaria_municipio_${i}" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Número de matrícula</label>
            <input type="text" class="form-control" name="secundaria_matricula_${i}" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Área utilizada (ha)</label>
            <input type="number" step="0.01" class="form-control" name="secundaria_area_${i}" required />
          </div>
          <div class="mb-3 obrigatorio-label">
            <label class="form-label">Você é o proprietário?</label>
            <select class="form-select" name="secundaria_proprietario_${i}" onchange="toggleProprietarioExtras(this, ${i})" required>
              <option value="">Selecione...</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
          <div id="extras_${i}" style="display:none;">
            <div class="mb-3">
              <label class="form-label">Nome ou Razão Social do Proprietário</label>
              <input type="text" class="form-control" name="secundaria_nome_proprietario_${i}" />
            </div>
            <div class="mb-3">
              <label class="form-label">CPF/CNPJ</label>
              <input type="text" class="form-control" name="secundaria_cpf_cnpj_${i}" />
            </div>
            <div class="mb-3">
              <label class="form-label">Percentual de Propriedade (%)</label>
              <input type="number" class="form-control" name="secundaria_percentual_${i}" />
            </div>
          </div>
        </div>
      `;
        }
      }

      function toggleProprietarioExtras(select, index) {
        const extras = document.getElementById("extras_" + index);
        if (select.value === "Não") {
          extras.style.display = "block";
        } else {
          extras.style.display = "none";
        }
      }

      function atualizarValorCredito(valor) {
        const exibido = document.getElementById("valor_credito_exibido");
        const valorFormatado = Number(valor).toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
          minimumFractionDigits: 2,
        });
        exibido.textContent = valorFormatado;
      }
    </script>

    <!-- Modal de Aviso -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const avisoModal = new bootstrap.Modal(
          document.getElementById("avisoModal")
        );
        avisoModal.show();
      });
    </script>

    <script>
      // Função para limpar todos os dados salvos (útil para testes)
      function clearAllSavedData() {
        if (
          confirm(
            "Tem certeza que deseja limpar todos os dados salvos? Esta ação não pode ser desfeita."
          )
        ) {
          FormStateManager.clearLocalStorage();
          location.reload();
        }
      }

      // Auto-save periódico
      setInterval(() => {
        saveAllFormsData();
      }, 30000); // Salva a cada 30 segundos

      // Salvar dados antes de sair da página
      window.addEventListener("beforeunload", function () {
        saveAllFormsData();
      });

      console.log("Sistema de preservação de estado carregado com sucesso!");
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        firebase.auth().onAuthStateChanged(function (user) {
          if (!user) {
            alert("Você precisa estar logado para enviar a solicitação.");
            window.location.href = "sign-in.html";
            return;
          }

          const form = document.getElementById("upgradeForm");
          const btnEnviar = document.getElementById("enviarFormulario");

          btnEnviar.addEventListener("click", async function (e) {
            e.preventDefault();

            // Estado "carregando"
            btnEnviar.innerHTML =
              'Enviando... <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>';
            btnEnviar.disabled = true;

            // Organizando os dados do formulário
            const formData = new FormData(form);
            const dados = {};

            formData.forEach((valor, chave) => {
              if (dados[chave]) {
                if (!Array.isArray(dados[chave])) {
                  dados[chave] = [dados[chave]];
                }
                dados[chave].push(valor);
              } else {
                dados[chave] = valor;
              }
            });

            // Adiciona os campos fixos
            dados.status = "inactive";
            dados.status_documentacao = "pendente";
            dados.status_solicitacao = "aguardando";
            dados.createdAt = firebase.firestore.Timestamp.now();
            dados.cliente_id = user.uid;
            dados.addedBy = user.email;

            try {
              await firebase.firestore().collection("custeio").add(dados);

              // Pop-up bonito
              Swal.fire({
                icon: "success",
                title: "Solicitação enviada com sucesso!",
                html: `Agora é hora de <strong>concluir sua solicitação</strong> com os documentos e informações necessárias.<br><br>
             Nossa equipe irá acompanhar tudo de perto para garantir a aprovação do seu crédito junto aos nossos bancos parceiros.`,
                confirmButtonText: "Entendi!",
                confirmButtonColor: "#198754",
              }).then(() => {
                window.location.href = "solicitacoes.html";
              });
            } catch (err) {
              console.error("Erro ao gravar no Firestore:", err);
              alert("Erro ao enviar. Tente novamente.");
              btnEnviar.innerHTML = "Enviar Formulário";
              btnEnviar.disabled = false;
            }
          });
        });
      });
    </script>
  </body>
</html>
