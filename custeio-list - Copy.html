<!DOCTYPE html>
<html data-theme="dark" lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Global - Crédito de Custeio</title>
    <link
      href="assets/images/favicon.png"
      rel="icon"
      sizes="16x16"
      type="image/png"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link href="assets/css/remixicon.css" rel="stylesheet" />
    <link href="assets/css/lib/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/lib/dataTables.min.css" rel="stylesheet" />
    <link href="assets/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <main class="dashboard-main">
      <div class="dashboard-main-body">
        <div
          class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24"
        >
          <h6 class="fw-semibold mb-0">Solicitações de Crédito de Custeio</h6>
          <ul class="d-flex align-items-center gap-2">
            <li class="fw-medium">
              <a
                class="d-flex align-items-center gap-1 hover-text-primary"
                href="index.html"
              >
                <iconify-icon
                  class="icon text-lg"
                  icon="solar:home-smile-angle-outline"
                ></iconify-icon>
                Dashboard
              </a>
            </li>
            <li>-</li>
            <li class="fw-medium">Crédito de Custeio</li>
          </ul>
        </div>
        <div class="card h-100 p-0 radius-12">
          <div
            class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3"
          >
            <div class="d-flex align-items-center flex-wrap gap-3 w-100">
              <span class="text-md fw-medium text-secondary-light mb-0"
                >Show</span
              >
              <select
                id="items-per-page"
                class="form-select form-select-sm w-auto"
              >
                <option value="1">1</option>
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
              </select>
              <div class="input-group w-auto">
                <span class="input-group-text bg-transparent border-end-0">
                  <iconify-icon icon="ion:search-outline"></iconify-icon>
                </span>
                <input
                  type="text"
                  id="search-input"
                  class="form-control border-start-0"
                  placeholder="Pesquisar por cliente..."
                />
              </div>
              <select id="filter-status-docs" class="form-select w-auto">
                <option value="">Status Documentação</option>
                <option value="pendente">Pendente</option>
                <option value="processando">Processando</option>
                <option value="verificado">Verificado</option>
              </select>
              <select id="filter-status-solic" class="form-select w-auto">
                <option value="">Status Solicitação</option>
                <option value="aguardando">Aguardando documentação</option>
                <option value="processando">Processando</option>
                <option value="aprovado">Aprovado</option>
                <option value="nao_aprovado">Não aprovado</option>
                <option value="concluido">Concluído</option>
              </select>
              <select id="order-by" class="form-select w-auto">
                <option value="createdAt_desc">Data Criação (mais novo)</option>
                <option value="createdAt_asc">
                  Data Criação (mais antigo)
                </option>
                <option value="valor_desc">Valor Crédito (maior)</option>
                <option value="valor_asc">Valor Crédito (menor)</option>
              </select>
              <button
                class="btn btn-success ms-auto"
                data-bs-target="#addCusteioModal"
                data-bs-toggle="modal"
                style="min-width: 180px"
              >
                + Nova Solicitação
              </button>
            </div>
          </div>
          <div class="card-body p-24">
            <div class="table-responsive scroll-sm">
              <table class="table bordered-table sm-table mb-0">
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>Valor Crédito</th>
                    <th>Responsável 1</th>
                    <th>Responsável 2</th>
                    <th>Status Documentação</th>
                    <th>Status Solicitação</th>
                    <th>Ações</th>
                    <th>Criado por</th>
                    <th>Data Solicitação</th>
                  </tr>
                </thead>
                <tbody id="custeio-tbody"></tbody>
              </table>
            </div>
            <div
              class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24"
            >
              <span id="pagination-info">Mostrando 1 a 10 de 0 registros</span>
              <ul
                class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center"
              ></ul>
            </div>
          </div>
        </div>
      </div>
      <footer class="d-footer">
        <div class="row align-items-center justify-content-between">
          <div class="col-auto">
            <p class="mb-0">© 2025 Global. All Rights Reserved.</p>
          </div>
          <div class="col-auto">
            <p class="mb-0">
              Made by <span class="text-primary-600">ComosTech</span>
            </p>
          </div>
        </div>
      </footer>
    </main>

    <!-- MODAL: Editar Solicitação de Crédito de Custeio -->

    <!-- MODAL: Upload de Imagem -->
    <div
      class="modal fade"
      id="uploadImageModal"
      tabindex="-1"
      aria-labelledby="uploadImageModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white rounded-4 shadow">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">
              <iconify-icon
                icon="ri:upload-cloud-line"
                class="me-2 text-primary"
              ></iconify-icon>
              Upload de Imagem
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="uploadImageForm" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="custeioImage" class="form-label"
                  >Selecione uma imagem</label
                >
                <input
                  class="form-control"
                  type="file"
                  id="custeioImage"
                  name="custeioImage"
                  accept="image/*"
                  required
                />
              </div>
              <div class="progress mb-3 d-none" id="uploadProgressBarContainer">
                <div
                  class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                  id="uploadProgressBar"
                  role="progressbar"
                  style="width: 0%"
                >
                  0%
                </div>
              </div>
              <!-- Mensagem de upload -->
              <div id="uploadMessage" class="text-center mt-2"></div>
              <input type="hidden" id="custeioIdHidden" name="custeioId" />
              <button type="submit" class="btn btn-success w-100">
                Enviar
              </button>
            </form>
            <div id="uploadImagePreview" class="mt-3 text-center"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- SCRIPTS DE BIBLIOTECA DEVEM VIR ANTES DO SEU SCRIPT CUSTOM -->
    <script src="assets/js/lib/jquery-3.7.1.min.js"></script>
    <script src="assets/js/lib/bootstrap.bundle.min.js"></script>
    <script src="assets/js/lib/iconify-icon.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <script>
      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyBxREWzRP-X8Q5b-BtiV6A1PFLbKSdfzwk",
        authDomain: "global-1a649.firebaseapp.com",
        projectId: "global-1a649",
        storageBucket: "global-1a649.appspot.com",
        messagingSenderId: "689137289621",
        appId: "1:689137289621:web:7595220d59d48d48960e9c",
      };
      if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      // Inicializa storage se ainda não existir
      const storage = firebase.storage();

      function setCurrentCusteioId(id) {
        document.getElementById("custeioIdHidden").value = id;
        document.getElementById("uploadImageForm").reset();
        document.getElementById("uploadImagePreview").innerHTML = "";
        document
          .getElementById("uploadProgressBarContainer")
          .classList.add("d-none");
        document.getElementById("uploadProgressBar").style.width = "0%";
        document.getElementById("uploadProgressBar").textContent = "0%";
        document.getElementById("uploadMessage").innerHTML = "";
        document
          .getElementById("uploadImageForm")
          .querySelector('button[type="submit"]').disabled = false;
      }

      // Upload com barra de progresso e feedback
      document
        .getElementById("uploadImageForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const fileInput = document.getElementById("custeioImage");
          const file = fileInput.files[0];
          const custeioId = document.getElementById("custeioIdHidden").value;
          const progressBarContainer = document.getElementById(
            "uploadProgressBarContainer"
          );
          const progressBar = document.getElementById("uploadProgressBar");
          const messageDiv = document.getElementById("uploadMessage");
          const submitBtn = document
            .getElementById("uploadImageForm")
            .querySelector('button[type="submit"]');

          if (!file || !custeioId) {
            messageDiv.innerHTML = `<span class="text-danger">Selecione uma imagem e um registro válido!</span>`;
            return;
          }

          // Reseta barra
          progressBarContainer.classList.remove("d-none");
          progressBar.style.width = "0%";
          progressBar.textContent = "0%";
          messageDiv.innerHTML = "";
          submitBtn.disabled = true;

          // Caminho sugerido
          const storageRef = storage.ref(
            `custeios/${custeioId}/${Date.now()}_${file.name}`
          );

          const uploadTask = storageRef.put(file);

          uploadTask.on(
            "state_changed",
            // Progresso
            function (snapshot) {
              const progress = Math.round(
                (snapshot.bytesTransferred / snapshot.totalBytes) * 100
              );
              progressBar.style.width = progress + "%";
              progressBar.textContent = progress + "%";
            },
            // Erro
            function (error) {
              messageDiv.innerHTML = `<span class="text-danger">Erro ao enviar: ${error.message}</span>`;
              progressBarContainer.classList.add("d-none");
              submitBtn.disabled = false;
            },
            // Completo
            async function () {
              const downloadURL =
                await uploadTask.snapshot.ref.getDownloadURL();
              // Salva a URL no Firestore
              try {
                await firebase
                  .firestore()
                  .collection("custeio")
                  .doc(custeioId)
                  .update({
                    docImageUrl: downloadURL,
                  });
                progressBar.style.width = "100%";
                progressBar.textContent = "100%";
                messageDiv.innerHTML = `<span class="text-success fw-bold">Imagem enviada com sucesso!</span>`;
                setTimeout(() => {
                  var modal = bootstrap.Modal.getInstance(
                    document.getElementById("uploadImageModal")
                  );
                  modal.hide();
                  // Limpa preview e barra depois de fechar
                  setTimeout(() => {
                    setCurrentCusteioId(custeioId);
                  }, 500);
                }, 1200);
                // Opcional: recarrega lista
                loadCusteios && loadCusteios();
              } catch (err) {
                messageDiv.innerHTML = `<span class="text-danger">Imagem enviada mas não foi possível salvar a URL: ${err.message}</span>`;
                submitBtn.disabled = false;
              }
            }
          );
        });

      // Protege a página: redireciona para login se não estiver autenticado e exibe nome
      firebase.auth().onAuthStateChanged(function (user) {
        if (!user) {
          window.location.href = "sign-in.html";
        } else {
          // Preenche o nome do usuário
          const elName = document.getElementById("user-profile-name");
          if (elName) {
            elName.textContent =
              user.displayName || user.email || user.phoneNumber || "Usuário";
          }
        }
      });

      // Botão logout
      $(document).on("click", "#logout-btn", function () {
        firebase
          .auth()
          .signOut()
          .then(function () {
            window.location.href = "sign-in.html";
          });
      });

      // Navegação entre as duas etapas (livre por clique)
      function showStepWizard(n) {
        $(".custeio-step").addClass("d-none");
        $("#step-" + n).removeClass("d-none");
        $("#wizard-steps .nav-link").removeClass("active");
        $("#nav-step-" + n).addClass("active");
      }
      $(document).on("click", "#wizard-steps .nav-link", function () {
        const n = $(this).data("step");
        showStepWizard(n);
      });
      $("#addCusteioModal").on("shown.bs.modal", function () {
        showStepWizard(1);
        $("#custeio-form")[0].reset();
        loadClientes();

        // Sempre zera o range do add
        setTimeout(function () {
          $("#valor_credito_add").val(1000000).trigger("input");
          $("#valorCreditoRangeLabelAdd").text(
            "R$ " +
              parseFloat(1000000).toLocaleString("pt-BR", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              })
          );
        }, 50);
      });

      $("#valor_credito_add").on("input", function () {
        $("#valorCreditoRangeLabelAdd").text(
          "R$ " +
            parseFloat(this.value).toLocaleString("pt-BR", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })
        );
      });
      $("#valorCreditoRangeLabelAdd").text(
        "R$ " +
          parseFloat(1000000).toLocaleString("pt-BR", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })
      );

      // Submissão do formulário (salva no Firestore)
      $("#custeio-form").submit(async function (e) {
        e.preventDefault();

        // Desabilita o botão para evitar duplo clique
        $("#save-custeio").prop("disabled", true).text("Salvando...");

        if (!$("#cliente_id").val()) {
          alert("Selecione o cliente para continuar!");
          $("#cliente_id").select2("open");
          $("#save-custeio").prop("disabled", false).text("Salvar Solicitação");
          return;
        }
        const formData = {};
        $(this)
          .find("input, select, textarea")
          .each(function () {
            formData[this.name] = $(this).val();
          });
        formData.createdAt = new Date();
        formData.status = "inactive";
        const user = firebase.auth().currentUser;
        formData.addedBy =
          (user && (user.displayName || user.email || user.phoneNumber)) ||
          "Usuário";
        try {
          await db.collection("custeio").add(formData);
          alert("Solicitação salva!");
          $("#addCusteioModal").modal("hide");
          // Reabilita o botão após sucesso
          $("#save-custeio").prop("disabled", false).text("Salvar Solicitação");
        } catch (err) {
          alert("Erro ao salvar: " + err.message);
          // Reabilita o botão também se der erro!
          $("#save-custeio").prop("disabled", false).text("Salvar Solicitação");
        }
      });

      let allCusteios = [];
      let currentPage = 1;
      let clientesList = [];
      window.gerentesList = [];
      window.agentesList = [];
      async function loadGerentes() {
        const snap = await db.collection("gerentes").get();
        window.gerentesList = snap.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
      }

      // Função para carregar agentes
      async function loadAgentes() {
        const snap = await db.collection("agentes").get();
        window.agentesList = snap.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
      }
      // Função principal para buscar e renderizar
      async function loadCusteios() {
        let snapshot = await db
          .collection("custeio")
          .orderBy("createdAt", "desc")
          .get();
        allCusteios = snapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
        renderTable();
      }

      // Função que monta e exibe a tabela
      function renderTable() {
        const searchTerm = $("#search-input").val().toLowerCase();
        const filterStatusDocs = $("#filter-status-docs").val();
        const filterStatusSolic = $("#filter-status-solic").val();
        const orderBy = $("#order-by").val();
        const itemsPerPage = parseInt($("#items-per-page").val() || 10, 10);

        let filtered = allCusteios.filter((c) => {
          // Busca pelo nome do cliente
          let clienteNome = "";
          if (
            c.cliente_id &&
            Array.isArray(clientesList) &&
            clientesList.length
          ) {
            const cli = clientesList.find((cl) => cl.id === c.cliente_id);
            clienteNome = cli ? cli.nome.toLowerCase() : "";
          }
          const matchesSearch = !searchTerm || clienteNome.includes(searchTerm);

          // Filtros novos
          const matchesStatusDocs =
            !filterStatusDocs ||
            (c.status_documentacao || "pendente") === filterStatusDocs;
          const matchesStatusSolic =
            !filterStatusSolic ||
            (c.status_solicitacao || "aguardando") === filterStatusSolic;

          return matchesSearch && matchesStatusDocs && matchesStatusSolic;
        });

        // Ordenação
        if (orderBy === "createdAt_desc") {
          filtered.sort(
            (a, b) =>
              (b.createdAt?.toDate ? b.createdAt.toDate().getTime() : 0) -
              (a.createdAt?.toDate ? a.createdAt.toDate().getTime() : 0)
          );
        } else if (orderBy === "createdAt_asc") {
          filtered.sort(
            (a, b) =>
              (a.createdAt?.toDate ? a.createdAt.toDate().getTime() : 0) -
              (b.createdAt?.toDate ? b.createdAt.toDate().getTime() : 0)
          );
        } else if (orderBy === "valor_desc") {
          filtered.sort(
            (a, b) =>
              Number(b.valor_credito || b.valorCredito || 0) -
              Number(a.valor_credito || a.valorCredito || 0)
          );
        } else if (orderBy === "valor_asc") {
          filtered.sort(
            (a, b) =>
              Number(a.valor_credito || a.valorCredito || 0) -
              Number(b.valor_credito || b.valorCredito || 0)
          );
        }

        // Paginação
        const start = (currentPage - 1) * itemsPerPage;
        const pageData = filtered.slice(start, start + itemsPerPage);

        $("#custeio-tbody").html(
          pageData
            .map((c) => {
              // -- MANTÉM SEU CÓDIGO DE RENDERIZAÇÃO DAS LINHAS AQUI --
              let clienteNome = "";
              if (
                c.cliente_id &&
                Array.isArray(clientesList) &&
                clientesList.length
              ) {
                const cli = clientesList.find((cl) => cl.id === c.cliente_id);
                clienteNome = cli ? cli.nome : "";
              }

              let valorCredito = c.valor_credito || c.valorCredito || "";

              let gerenteNome = "";
              if (c.responsavelGerenteId && window.gerentesList) {
                const gerente = window.gerentesList.find(
                  (g) => g.id === c.responsavelGerenteId
                );
                gerenteNome =
                  gerente && (gerente.nome_completo || gerente.email)
                    ? gerente.nome_completo || gerente.email
                    : c.responsavelGerenteId || "";
              } else {
                gerenteNome = c.responsavelGerenteId || "";
              }

              let resp2Nome = "";
              if (c.responsavelSecundarioId) {
                let agente = window.agentesList
                  ? window.agentesList.find(
                      (a) => a.id === c.responsavelSecundarioId
                    )
                  : null;
                if (agente) {
                  resp2Nome =
                    (agente.nome_completo || agente.email || "") + " (Agente)";
                } else if (window.gerentesList) {
                  let gerente2 = window.gerentesList.find(
                    (g) => g.id === c.responsavelSecundarioId
                  );
                  resp2Nome =
                    gerente2 && (gerente2.nome_completo || gerente2.email)
                      ? gerente2.nome_completo || gerente2.email
                      : c.responsavelSecundarioId;
                } else {
                  resp2Nome = c.responsavelSecundarioId;
                }
              }
              let statusDocs = c.status_documentacao || "pendente";
              let podeAlterarStatusSol = statusDocs === "verificado";
              let statusDocsLabel = "";
              let statusDocsClass = "";
              switch (statusDocs) {
                case "verificado":
                  statusDocsLabel = "Verificado";
                  statusDocsClass = "bg-success";
                  break;
                case "processando":
                  statusDocsLabel = "Processando";
                  statusDocsClass = "bg-primary";
                  break;
                default:
                  statusDocsLabel = "Pendente";
                  statusDocsClass = "bg-warning";
              }

              let statusSol = c.status_solicitacao || "aguardando";
              let statusSolLabel = "";
              let statusSolClass = "";
              switch (statusSol) {
                case "processando":
                  statusSolLabel = "Processando";
                  statusSolClass = "bg-primary";
                  break;
                case "aprovado":
                  statusSolLabel = "Aprovado";
                  statusSolClass = "bg-success";
                  break;
                case "nao_aprovado":
                  statusSolLabel = "Não aprovado";
                  statusSolClass = "bg-danger";
                  break;
                case "concluido":
                  statusSolLabel = "Concluído";
                  statusSolClass = "bg-info";
                  break;
                default:
                  statusSolLabel = "Aguardando documentação";
                  statusSolClass = "bg-secondary";
              }

              const btnDocs = `
  <button class="btn btn-sm btn-info me-1 btn-open-upload-modal" 
    data-id="${c.id}">
    Documentos
  </button>
`;

              return `
<tr>
  <td>${clienteNome || ""}</td>
 <td>${
   valorCredito
     ? "R$ " +
       Number(valorCredito).toLocaleString("pt-BR", {
         minimumFractionDigits: 2,
         maximumFractionDigits: 2,
       })
     : ""
 }</td>
  <td>${gerenteNome}</td>
  <td>${resp2Nome}</td>
  <td>
    <div class="dropdown">
      <button class="badge px-3 py-2 ${statusDocsClass} text-white dropdown-toggle" type="button"
        data-bs-toggle="dropdown" aria-expanded="false" style="border:none;cursor:pointer;">
        ${statusDocsLabel}
      </button>
      <ul class="dropdown-menu">
        <li>
          <a class="dropdown-item text-white bg-warning" href="#" onclick="updateStatusDocs('${
            c.id
          }', 'pendente')">Pendente</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-primary" href="#" onclick="updateStatusDocs('${
            c.id
          }', 'processando')">Processando</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-success" href="#" onclick="updateStatusDocs('${
            c.id
          }', 'verificado')">Verificado</a>
        </li>
      </ul>
    </div>
  </td>
  <td>
    <div class="dropdown">
      <button class="badge px-3 py-2 ${statusSolClass} text-white dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
        style="border:none;cursor:pointer;"
        ${
          !podeAlterarStatusSol
            ? "disabled title='Só pode alterar após documentação verificada'"
            : ""
        }
      >
        ${statusSolLabel}
      </button>
      <ul class="dropdown-menu">
        <li>
          <a class="dropdown-item text-dark bg-secondary" href="#" onclick="updateStatusSol('${
            c.id
          }', 'aguardando')" ${
                !podeAlterarStatusSol
                  ? "style='pointer-events:none;opacity:0.7;'"
                  : ""
              }>Aguardando documentação</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-primary" href="#" onclick="updateStatusSol('${
            c.id
          }', 'processando')" ${
                !podeAlterarStatusSol
                  ? "style='pointer-events:none;opacity:0.7;'"
                  : ""
              }>Processando</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-success" href="#" onclick="updateStatusSol('${
            c.id
          }', 'aprovado')" ${
                !podeAlterarStatusSol
                  ? "style='pointer-events:none;opacity:0.7;'"
                  : ""
              }>Aprovado</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-danger" href="#" onclick="updateStatusSol('${
            c.id
          }', 'nao_aprovado')" ${
                !podeAlterarStatusSol
                  ? "style='pointer-events:none;opacity:0.7;'"
                  : ""
              }>Não aprovado</a>
        </li>
        <li>
          <a class="dropdown-item text-white bg-info" href="#" onclick="updateStatusSol('${
            c.id
          }', 'concluido')" ${
                !podeAlterarStatusSol
                  ? "style='pointer-events:none;opacity:0.7;'"
                  : ""
              }>Concluído</a>
        </li>
      </ul>
    </div>
  </td>
  <td class="text-center">
    ${btnDocs}
    <button class="btn btn-sm btn-warning me-1" onclick="openEditCusteio('${
      c.id
    }')">Editar</button>
    <button class="btn btn-sm btn-danger" onclick="deleteCusteio('${
      c.id
    }')">Deletar</button>
  </td>
  <td>${c.addedBy || ""}</td>
  <td>${
    c.createdAt && c.createdAt.toDate
      ? c.createdAt.toDate().toLocaleDateString()
      : ""
  }</td>
</tr>
        `;
            })
            .join("") ||
            `<tr><td colspan='9' class='text-center'>Nenhum registro encontrado</td></tr>`
        );
        $(document)
          .off("click", ".btn-open-upload-modal")
          .on("click", ".btn-open-upload-modal", function () {
            const custeioId = $(this).data("id");
            setCurrentCusteioId(custeioId);
            var modal = new bootstrap.Modal(
              document.getElementById("uploadImageModal")
            );
            modal.show();
          });

        renderPagination(filtered.length, itemsPerPage);

        $("#pagination-info").text(
          `Mostrando ${filtered.length === 0 ? 0 : start + 1} a ${Math.min(
            start + itemsPerPage,
            filtered.length
          )} de ${filtered.length} registros`
        );

        // BIND do modal SEMPRE ao final do renderTable!
        $(document)
          .off("click", ".btn-open-upload-modal")
          .on("click", ".btn-open-upload-modal", function () {
            const custeioId = $(this).data("id");
            setCurrentCusteioId(custeioId);
            $("#uploadImageModal").modal("show");
          });
      }
      $("#search-input").on("input", function () {
        currentPage = 1;
        renderTable();
      });
      $(
        "#filter-status-docs, #filter-status-solic, #order-by, #items-per-page"
      ).on("change", function () {
        currentPage = 1;
        renderTable();
      });
      function renderPagination(total, itemsPerPage) {
        const pages = Math.ceil(total / itemsPerPage);
        const pagination = $(".pagination").first();
        pagination.html("");
        for (let i = 1; i <= pages; i++) {
          const li = $(
            `<li class="page-item"><a href="#" class="page-link ${
              i === currentPage ? "active" : ""
            }">${i}</a></li>`
          );
          li.on("click", function (e) {
            e.preventDefault();
            currentPage = i;
            renderTable();
          });
          pagination.append(li);
        }
      }

      // Busca clientes do banco
      // Busca clientes do banco
      async function loadClientes() {
        let snap = await db.collection("clientes").get();
        clientesList = snap.docs.map((doc) => ({
          id: doc.id,
          nome:
            doc.data().nome ||
            doc.data().email ||
            doc.data().empresa ||
            doc.data().contato ||
            "Cliente",
        }));
        let options = `<option value="">Selecione o cliente...</option>`;
        clientesList.forEach(
          (c) => (options += `<option value="${c.id}">${c.nome}</option>`)
        );
        $("#cliente_id").html(options);

        // Destroy anterior antes de criar novamente
        if ($("#cliente_id").hasClass("select2-hidden-accessible")) {
          $("#cliente_id").select2("destroy");
        }

        $("#cliente_id").select2({
          dropdownParent: $("#addCusteioModal"),
          width: "100%",
          placeholder: "Selecione o cliente...",
          allowClear: true,
        });
      }

      // Busca/filtro/paginação/lista sempre carrega clientes antes de montar a tabela
      firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
          Promise.all([loadClientes(), loadGerentes(), loadAgentes()]).then(
            loadCusteios
          );
        }
      });

      // Após salvar um novo registro, recarrega tabela:
      $("#custeio-form").on("submit", function () {
        setTimeout(loadCusteios, 1000);
      });

      // Eventos para busca, filtros e itens por página
      $("#search-input").on("input", function () {
        currentPage = 1;
        renderTable();
      });
      $("#filter-status, #filter-tipo-produtor, #items-per-page").on(
        "change",
        function () {
          currentPage = 1;
          renderTable();
        }
      );

      // Wizard edit: navegação por etapas
      function showEditStepWizard(n) {
        $(".edit-custeio-step").addClass("d-none");
        $("#edit-step-" + n).removeClass("d-none");
        $("#wizard-edit-steps .nav-link").removeClass("active");
        $("#edit-nav-step-" + n).addClass("active");
      }
      $(document).on("click", "#wizard-edit-steps .nav-link", function () {
        let n = $(this).data("step");
        showEditStepWizard(n);
      });
      $("#editCusteioModal").on("shown.bs.modal", function () {
        showEditStepWizard(1);
      });

      // Abre modal de edição preenchido
      window.openEditCusteio = async function (id) {
        const custeio = allCusteios.find((c) => c.id === id);
        if (!custeio) return;

        // Carrega os responsáveis e só então seta os valores dos selects
        await preencherResponsaveisCusteio();

        $("#edit_id").val(custeio.id);
        $("#edit-responsavel-gerente").val(custeio.responsavelGerenteId || "");
        $("#edit-responsavel-secundario").val(
          custeio.responsavelSecundarioId || ""
        );

        // Valor do crédito
        let valorCredito = custeio.valor_credito || 1000000;
        $("#valor_credito_edit").val(valorCredito).trigger("input");
        $("#valorCreditoRangeLabelEdit").text(
          "R$ " +
            parseFloat(valorCredito).toLocaleString("pt-BR", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })
        );
        $("#valor_credito_edit").on("input", function () {
          $("#valorCreditoRangeLabelEdit").text(
            "R$ " +
              parseFloat(this.value).toLocaleString("pt-BR", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              })
          );
        });

        // Etapa 1 - Produtor Rural
        $("#edit_produtor_tipo").val(custeio.produtor_tipo || "");
        $("#edit_cpf_cnpj").val(custeio.cpf_cnpj || "");
        $("#edit_perfil_produtor").val(custeio.perfil_produtor || "");
        $("#edit_experiencia").val(custeio.experiencia || "");
        $("#edit_assistencia_tecnica").val(custeio.assistencia_tecnica || "");
        $("#edit_desembolso_familiar").val(custeio.desembolso_familiar || "");
        $("#edit_dividas_vencer").val(custeio.dividas_vencer || "");
        $("#edit_dividas_fornecedores").val(custeio.dividas_fornecedores || "");
        $("#edit_custeio_outras").val(custeio.custeio_outras || "");
        $("#edit_custeio_prorrogado").val(custeio.custeio_prorrogado || "");
        $("#edit_investimento_outras").val(custeio.investimento_outras || "");
        $("#edit_atividade_rural").val(custeio.atividade_rural || "");

        // Etapa 2 - Cultura Anual
        $("#edit_cultura_anual").val(custeio.cultura_anual || "");
        $("#edit_safra_prevista").val(custeio.safra_prevista || "");
        $("#edit_ano_colheita").val(custeio.ano_colheita || "");
        $("#edit_anterior_3").val(custeio.anterior_3 || "");
        $("#edit_anterior_2").val(custeio.anterior_2 || "");
        $("#edit_anterior_1").val(custeio.anterior_1 || "");
        $("#edit_municipio_anual").val(custeio.municipio_anual || "");
        $("#edit_matricula_anual").val(custeio.matricula_anual || "");
        $("#edit_area_plantio_anual").val(custeio.area_plantio_anual || "");
        $("#edit_pct_irrigacao_anual").val(custeio.pct_irrigacao_anual || "");
        $("#edit_pct_mecanizacao_anual").val(
          custeio.pct_mecanizacao_anual || ""
        );
        $("#edit_pct_consumo_anual").val(custeio.pct_consumo_anual || "");
        $("#edit_pct_armazenamento_anual").val(
          custeio.pct_armazenamento_anual || ""
        );
        $("#edit_produtividade_media_anual").val(
          custeio.produtividade_media_anual || ""
        );
        $("#edit_nivel_tecnologico_anual").val(
          custeio.nivel_tecnologico_anual || ""
        );
        $("#edit_receita_estim_anual").val(custeio.receita_estim_anual || "");
        $("#edit_despesa_estim_anual").val(custeio.despesa_estim_anual || "");
        $("#edit_ano_safra_anual").val(custeio.ano_safra_anual || "");

        // Etapa 3 - Cultura Perene
        $("#edit_cultura_perene").val(custeio.cultura_perene || "");
        $("#edit_ano_colheita_perene").val(custeio.ano_colheita_perene || "");
        $("#edit_area_plantada_3_perene").val(
          custeio.area_plantada_3_perene || ""
        );
        $("#edit_area_plantada_2_perene").val(
          custeio.area_plantada_2_perene || ""
        );
        $("#edit_area_plantada_1_perene").val(
          custeio.area_plantada_1_perene || ""
        );
        $("#edit_area_renovada_3_perene").val(
          custeio.area_renovada_3_perene || ""
        );
        $("#edit_area_renovada_2_perene").val(
          custeio.area_renovada_2_perene || ""
        );
        $("#edit_area_renovada_1_perene").val(
          custeio.area_renovada_1_perene || ""
        );
        $("#edit_municipio_perene").val(custeio.municipio_perene || "");
        $("#edit_matricula_perene").val(custeio.matricula_perene || "");
        $("#edit_safra_prevista_perene").val(
          custeio.safra_prevista_perene || ""
        );
        $("#edit_area_plantio_atual_perene").val(
          custeio.area_plantio_atual_perene || ""
        );
        $("#edit_area_renovada_safra_perene").val(
          custeio.area_renovada_safra_perene || ""
        );
        $("#edit_pct_irrigacao_perene").val(custeio.pct_irrigacao_perene || "");
        $("#edit_pct_mecanizacao_perene").val(
          custeio.pct_mecanizacao_perene || ""
        );
        $("#edit_pct_consumo_perene").val(custeio.pct_consumo_perene || "");
        $("#edit_pct_armazenamento_perene").val(
          custeio.pct_armazenamento_perene || ""
        );
        $("#edit_produtividade_perene").val(custeio.produtividade_perene || "");
        $("#edit_nivel_tecnologico_perene").val(
          custeio.nivel_tecnologico_perene || ""
        );
        $("#edit_ano_safra_perene").val(custeio.ano_safra_perene || "");
        $("#edit_preco_venda_perene").val(custeio.preco_venda_perene || "");
        $("#edit_custo_producao_perene").val(
          custeio.custo_producao_perene || ""
        );
        $("#edit_custo_renovacao_perene").val(
          custeio.custo_renovacao_perene || ""
        );

        // Etapa 4 - Agricultura Geral
        $("#edit_cultura_geral").val(custeio.cultura_geral || "");
        $("#edit_ano_colheita_geral").val(custeio.ano_colheita_geral || "");
        $("#edit_forma_cultivo_geral").val(custeio.forma_cultivo_geral || "");
        $("#edit_ident_safra_geral").val(custeio.ident_safra_geral || "");
        $("#edit_municipio_geral").val(custeio.municipio_geral || "");
        $("#edit_matricula_geral").val(custeio.matricula_geral || "");
        $("#edit_safra_prevista_geral").val(custeio.safra_prevista_geral || "");
        $("#edit_area_plantio_geral").val(custeio.area_plantio_geral || "");
        $("#edit_produtividade_geral").val(custeio.produtividade_geral || "");
        $("#edit_contrato_pre_venda_geral").val(
          custeio.contrato_pre_venda_geral || ""
        );
        $("#edit_nivel_tecnologico_geral").val(
          custeio.nivel_tecnologico_geral || ""
        );
        $("#edit_ano_safra_geral").val(custeio.ano_safra_geral || "");
        $("#edit_preco_venda_geral").val(custeio.preco_venda_geral || "");
        $("#edit_custo_unitario_geral").val(custeio.custo_unitario_geral || "");

        // Etapa 5 - Bovino de Corte (incluindo vendas)
        $("#edit_municipio_corte").val(custeio.municipio_corte || "");
        $("#edit_matricula_corte").val(custeio.matricula_corte || "");
        $("#edit_ciclo_producao_corte").val(custeio.ciclo_producao_corte || "");
        $("#edit_sistema_producao_corte").val(
          custeio.sistema_producao_corte || ""
        );
        $("#edit_bezerros_machos_ate12_corte").val(
          custeio.bezerros_machos_ate12_corte || ""
        );
        $("#edit_bezerras_femeas_ate12_corte").val(
          custeio.bezerras_femeas_ate12_corte || ""
        );
        $("#edit_garrotes_machos_12a24_corte").val(
          custeio.garrotes_machos_12a24_corte || ""
        );
        $("#edit_novilhotas_femeas_12a24_corte").val(
          custeio.novilhotas_femeas_12a24_corte || ""
        );
        $("#edit_novilhos_machos_24a36_corte").val(
          custeio.novilhos_machos_24a36_corte || ""
        );
        $("#edit_novilhas_femeas_24a36_corte").val(
          custeio.novilhas_femeas_24a36_corte || ""
        );
        $("#edit_bois_acima36_corte").val(custeio.bois_acima36_corte || "");
        $("#edit_vacas_acima36_corte").val(custeio.vacas_acima36_corte || "");
        $("#edit_touros_reprodutores_corte").val(
          custeio.touros_reprodutores_corte || ""
        );
        $("#edit_area_pastagem_corte").val(custeio.area_pastagem_corte || "");
        $("#edit_custo_anual_corte").val(custeio.custo_anual_corte || "");
        // Vendas - bovino de corte
        $("#edit_bezerros_machos_venda_cab_corte").val(
          custeio.bezerros_machos_venda_cab_corte || ""
        );
        $("#edit_bezerros_machos_venda_valor_corte").val(
          custeio.bezerros_machos_venda_valor_corte || ""
        );
        $("#edit_bezerras_femeas_venda_cab_corte").val(
          custeio.bezerras_femeas_venda_cab_corte || ""
        );
        $("#edit_bezerras_femeas_venda_valor_corte").val(
          custeio.bezerras_femeas_venda_valor_corte || ""
        );
        $("#edit_garrotes_machos_venda_cab_corte").val(
          custeio.garrotes_machos_venda_cab_corte || ""
        );
        $("#edit_garrotes_machos_venda_valor_corte").val(
          custeio.garrotes_machos_venda_valor_corte || ""
        );
        $("#edit_novilhotas_femeas_venda_cab_corte").val(
          custeio.novilhotas_femeas_venda_cab_corte || ""
        );
        $("#edit_novilhotas_femeas_venda_valor_corte").val(
          custeio.novilhotas_femeas_venda_valor_corte || ""
        );
        $("#edit_novilhos_machos_venda_cab_corte").val(
          custeio.novilhos_machos_venda_cab_corte || ""
        );
        $("#edit_novilhos_machos_venda_valor_corte").val(
          custeio.novilhos_machos_venda_valor_corte || ""
        );
        $("#edit_novilhas_femeas_venda_cab_corte").val(
          custeio.novilhas_femeas_venda_cab_corte || ""
        );
        $("#edit_novilhas_femeas_venda_valor_corte").val(
          custeio.novilhas_femeas_venda_valor_corte || ""
        );
        $("#edit_bois_magros_venda_cab_corte").val(
          custeio.bois_magros_venda_cab_corte || ""
        );
        $("#edit_bois_magros_venda_valor_corte").val(
          custeio.bois_magros_venda_valor_corte || ""
        );
        $("#edit_vacas_magras_venda_cab_corte").val(
          custeio.vacas_magras_venda_cab_corte || ""
        );
        $("#edit_vacas_magras_venda_valor_corte").val(
          custeio.vacas_magras_venda_valor_corte || ""
        );
        $("#edit_bois_gordos_venda_cab_corte").val(
          custeio.bois_gordos_venda_cab_corte || ""
        );
        $("#edit_bois_gordos_venda_valor_corte").val(
          custeio.bois_gordos_venda_valor_corte || ""
        );
        $("#edit_vacas_gordas_venda_cab_corte").val(
          custeio.vacas_gordas_venda_cab_corte || ""
        );
        $("#edit_vacas_gordas_venda_valor_corte").val(
          custeio.vacas_gordas_venda_valor_corte || ""
        );

        // Etapa 6 - Bovino de Leite (incluindo vendas)
        $("#edit_municipio_leite").val(custeio.municipio_leite || "");
        $("#edit_matricula_leite").val(custeio.matricula_leite || "");
        $("#edit_sistema_ordenha_leite").val(
          custeio.sistema_ordenha_leite || ""
        );
        $("#edit_produtividade_media_leite").val(
          custeio.produtividade_media_leite || ""
        );
        $("#edit_raca_predominante_leite").val(
          custeio.raca_predominante_leite || ""
        );
        $("#edit_area_pastagem_leite").val(custeio.area_pastagem_leite || "");
        $("#edit_bezerros_ate12_leite").val(custeio.bezerros_ate12_leite || "");
        $("#edit_novilhos_leite").val(custeio.novilhos_leite || "");
        $("#edit_novilhas_leite").val(custeio.novilhas_leite || "");
        $("#edit_vacas_leiteiras_leite").val(
          custeio.vacas_leiteiras_leite || ""
        );
        $("#edit_touros_reprodutores_leite").val(
          custeio.touros_reprodutores_leite || ""
        );
        $("#edit_custo_anual_leite").val(custeio.custo_anual_leite || "");
        $("#edit_qtd_leite_vendido_leite").val(
          custeio.qtd_leite_vendido_leite || ""
        );
        $("#edit_valor_litro_leite").val(custeio.valor_litro_leite || "");
        $("#edit_bezerros_nascidos_leite").val(
          custeio.bezerros_nascidos_leite || ""
        );
        $("#edit_bezerros_nascidos_valor_leite").val(
          custeio.bezerros_nascidos_valor_leite || ""
        );
        $("#edit_bezerros_desmamados_leite").val(
          custeio.bezerros_desmamados_leite || ""
        );
        $("#edit_bezerros_desmamados_valor_leite").val(
          custeio.bezerros_desmamados_valor_leite || ""
        );
        $("#edit_vacas_descarte_leite").val(custeio.vacas_descarte_leite || "");
        $("#edit_vacas_descarte_valor_leite").val(
          custeio.vacas_descarte_valor_leite || ""
        );
        $("#edit-responsavel-gerente").val(custeio.responsavelGerenteId || "");
        $("#edit-responsavel-secundario").val(
          custeio.responsavelSecundarioId || ""
        );

        $("#editCusteioModal").modal("show");
      };

      // Salva alterações
      $("#edit-custeio-form").submit(async function (e) {
        e.preventDefault();
        const id = $("#edit_id").val();
        const data = {};
        $(this)
          .find("input, select, textarea")
          .each(function () {
            if (this.id !== "edit_id" && this.name)
              data[this.name] = $(this).val();
          });
        try {
          await db.collection("custeio").doc(id).update(data);
          alert("Solicitação atualizada com sucesso!");
          $("#editCusteioModal").modal("hide");
          loadCusteios();
        } catch (err) {
          alert("Erro ao atualizar: " + err.message);
        }
      });
      // Deletar registro
      window.deleteCusteio = async function (id) {
        if (!confirm("Tem certeza que deseja deletar esta solicitação?"))
          return;
        try {
          await db.collection("custeio").doc(id).delete();
          loadCusteios();
        } catch (err) {
          alert("Erro ao deletar: " + err.message);
        }
      };
      window.updateStatusDocs = async function (id, status) {
        try {
          await db.collection("custeio").doc(id).update({
            status_documentacao: status,
          });
          loadCusteios();
        } catch (err) {
          alert("Erro ao atualizar status da documentação: " + err.message);
        }
      };

      window.updateStatusSol = async function (id, status) {
        try {
          await db.collection("custeio").doc(id).update({
            status_solicitacao: status,
          });
          loadCusteios();
        } catch (err) {
          alert("Erro ao atualizar status da solicitação: " + err.message);
        }
      };
    </script>

    <script>
      async function preencherResponsaveisCusteio() {
        const gerenteSelect = document.getElementById(
          "edit-responsavel-gerente"
        );
        const secundarioSelect = document.getElementById(
          "edit-responsavel-secundario"
        );

        gerenteSelect.innerHTML = '<option value="">Não atribuído</option>';
        secundarioSelect.innerHTML = '<option value="">Não atribuído</option>';

        // Gerentes
        const gerentesSnap = await firebase
          .firestore()
          .collection("gerentes")
          .get();
        gerentesSnap.forEach((doc) => {
          const gerente = doc.data();
          const label = gerente.nome_completo || gerente.email || "(sem nome)";
          const option = document.createElement("option");
          option.value = doc.id;
          option.textContent = label;
          gerenteSelect.appendChild(option);
          secundarioSelect.appendChild(option.cloneNode(true));
        });

        // Agentes (apenas no secundário)
        const agentesSnap = await firebase
          .firestore()
          .collection("agentes")
          .get();
        agentesSnap.forEach((doc) => {
          const agente = doc.data();
          const label = agente.nome_completo || agente.email || "(sem nome)";
          const option = document.createElement("option");
          option.value = doc.id;
          option.textContent = label + " (Agente)";
          secundarioSelect.appendChild(option);
        });
      }
    </script>

    <style>
      /* Barra mais arredondada */
      .progress-bar {
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
      }

      /* Garante que o modal-content possa rolar se o conteúdo for maior que a tela */
      .modal-xl .modal-content {
        max-height: 90vh;
        overflow-y: auto;
      }

      /* Garante que a área das etapas também role se ficar grande */
      #addCusteioModal .modal-body {
        max-height: 70vh;
        overflow-y: auto;
      }

      /* Opcional: Evita barra dupla de rolagem em etapas */
      .custeio-step {
        /* Por padrão, apenas o modal-body rola */
        overflow: unset !important;
      }
      .dropdown-menu .dropdown-item {
        margin: 4px 0;
        border-radius: 8px !important;
        text-align: center;
        font-weight: 500;
      }
      .dropdown-menu .dropdown-item.bg-warning {
        background-color: #ffc107 !important;
        color: #212529 !important;
      }
      .dropdown-menu .dropdown-item.bg-primary {
        background-color: #0d6efd !important;
        color: #fff !important;
      }
      .dropdown-menu .dropdown-item.bg-success {
        background-color: #198754 !important;
        color: #fff !important;
      }
      .dropdown-menu .dropdown-item.bg-danger {
        background-color: #dc3545 !important;
        color: #fff !important;
      }
      .dropdown-menu .dropdown-item:hover,
      .dropdown-menu .dropdown-item:focus {
        opacity: 0.85;
      }

      /* Select2 single, fundo escuro e largura total */
      .select2-container--default .select2-selection--single {
        background-color: #22252a !important;
        border: 1px solid #40444b !important;
        min-height: 48px !important;
        height: 48px !important;
        border-radius: 8px !important;
        display: flex !important;
        align-items: center !important;
        width: 100% !important;
        min-width: 0 !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        box-shadow: none !important;
      }

      /* Container principal do select2 */
      .select2-container {
        width: 100% !important;
        min-width: 0 !important;
        max-width: 100% !important;
        display: block;
      }

      /* Texto do item selecionado: branco, negrito */
      .select2-container--default
        .select2-selection--single
        .select2-selection__rendered {
        color: #fff !important;
        font-weight: bold !important;
        opacity: 1 !important;
        line-height: 48px !important;
        font-size: 1rem !important;
        padding-left: 12px !important;
      }

      /* Placeholder: cinza suave */
      .select2-container--default
        .select2-selection--single
        .select2-selection__placeholder {
        color: #b0b0b0 !important;
        opacity: 1 !important;
        font-weight: normal !important;
      }

      /* Dropdown arrow */
      .select2-container--default
        .select2-selection--single
        .select2-selection__arrow
        b {
        border-color: #fff transparent transparent transparent !important;
      }

      /* Dropdown menu */
      .select2-container--default .select2-dropdown {
        background-color: #23272f !important;
        border: 1px solid #40444b !important;
        color: #fff !important;
      }

      /* Opções no dropdown */
      .select2-container--default .select2-results__option {
        background-color: #23272f !important;
        color: #fff !important;
        border-radius: 0 !important;
      }

      /* Hover/selecionado */
      .select2-container--default
        .select2-results__option--highlighted[aria-selected] {
        background-color: #1d2228 !important;
        color: #fff !important;
      }

      /* Estado de foco/ativo */
      .select2-container--default .select2-selection--single:focus,
      .select2-container--default .select2-selection--single:active {
        border-color: #3ecf8e !important; /* verde claro */
        box-shadow: 0 0 0 1px #3ecf8e !important;
      }

      /* Botão "x" (limpar seleção) */
      .select2-container--default
        .select2-selection--single
        .select2-selection__clear {
        color: #fff !important;
        font-size: 1.2em !important;
        margin-right: 8px;
        margin-left: 4px;
        opacity: 1 !important;
      }

      /* Responsivo para telas menores */
      @media (max-width: 600px) {
        .select2-container--default .select2-selection--single {
          min-height: 40px !important;
          height: 40px !important;
          font-size: 0.95rem !important;
        }
        .select2-container--default
          .select2-selection--single
          .select2-selection__rendered {
          font-size: 0.95rem !important;
          line-height: 40px !important;
        }
      }
    </style>
  </body>
</html>
